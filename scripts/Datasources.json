{
  "content": "/**\n * Retrieves records for CurrentUser datasource.\n * @return {Array\u003cDirectory\u003e} set of records for the datasource.\n */\nfunction getCurrentUser_() {\n  var currentUser \u003d Session.getActiveUser().getEmail();\n  var query \u003d app.models.Directory.newQuery();\n  query.filters.PrimaryEmail._equals \u003d currentUser;\n  return query.run();\n}\n\n\n/**\n * Retrieves records for AwaitingMyApproval \u0026 AwaitingMyApprovalCount datasources.\n * @param {RecordQuery} query - query object of the datasource;\n * @return {Array\u003cApprover\u003e} list of approvals.\n */\nfunction getAwaitingMyApproval_(query) {\n  var innerQuery \u003d app.models.Approver.newQuery({\n    sorting: query.valueOf().sorting\n  });\n  \n  innerQuery.filters.Email._equals \u003d Session.getActiveUser().getEmail();\n  innerQuery.prefetch.WorkflowStage._add();\n  innerQuery.prefetch.WorkflowStage.Request._add();\n  \n  if (!query.parameters.showAll) {\n    innerQuery.filters.Status._equals \u003d Status.Pending;\n  }\n  \n  if (query.parameters.showAll) {\n    innerQuery.offset \u003d query.offset;\n    innerQuery.limit \u003d query.limit;\n  }\n  \n  var allMyApprovals \u003d innerQuery.run();\n  \n  if (!query.parameters.showAll) {\n    var awaitingMyApproval \u003d [];\n\n    for (var i \u003d 0; i \u003c allMyApprovals.length; i++) {\n      var approval \u003d allMyApprovals[i];\n\n      if (approval.WorkflowStage.Request.Status \u003d\u003d\u003d Status.Pending \u0026\u0026 \n          approval.WorkflowStage.Request.Archived \u003d\u003d\u003d false) {\n        awaitingMyApproval.push(approval);\n      }\n    }\n    \n    if (awaitingMyApproval.slice(query.offset, query.offset + query.limit + 1))\n    \n    return awaitingMyApproval;\n  }\n  \n  return allMyApprovals;\n}\n\n\n/**\n * Checks that application settings\u0027 record already exists.\n * Otherwise creates a new one.\n * Used by AppSettings datasource.\n * @return {Array\u003cAppSettings\u003e} user record as an array.\n */\nfunction getSettingsRecord_() {\n  var newQuery \u003d app.models.AppSettings.newQuery();\n  var settingsRecords \u003d newQuery.run();\n  \n  if (settingsRecords.length \u003d\u003d\u003d 0) {\n    var settingsRecord \u003d app.models.AppSettings.newRecord();\n    settingsRecord.AppName \u003d \u0027Document Approval\u0027;\n    settingsRecord.FeatureImageUrl \u003d \u0027https://www.gstatic.com/appmaker/wallpaper-kleiner-google-blue.jpg\u0027;\n    settingsRecord.LogoUrl \u003d \u0027https://www.gstatic.com/appmaker/logo_google_now_color_1x_web_512dp.png\u0027;\n    settingsRecord.AppUrl \u003d ScriptApp.getService().getUrl();\n    settingsRecord.Pages \u003d \u0027Main,Admin,Approve\u0027;\n    \n    settingsRecord.NotificationEmailSubject \u003d \u0027Please review the following request\u0027;\n    settingsRecord.NotificationEmail \u003d \u0027\u003cp\u003ePlease review the following document \u0027 +\n      \u0027\u003c? if (data.Request.DocumentUrl) { ?\u003e\u0027 +\n      \u0027\u003ca href\u003d\"\u003c?\u003d data.Request.DocumentUrl ?\u003e\" target\u003d\"_blank\"\u003e\u003c?\u003d data.Request.DocumentName ?\u003e\u003c\/a\u003e\u0027 +\n      \u0027\u003c? } else { ?\u003e\u0027 +\n      \u0027  \u003c?\u003d data.Request.DocumentName ?\u003e\u0027 +\n      \u0027\u003c? } ?\u003e\u003c\/p\u003e\u0027 +\n      \u0027\u003cp\u003eClick \u003ca href\u003d\"\u003c?\u003d data.AppUrlApprove ?\u003e\" target\u003d\"_blank\"\u003ehere\u003c\/a\u003e to approve or reject.\u003c\/p\u003e\u0027;\n    \n    settingsRecord.ApprovedEmailSubject \u003d \u0027Your request has been approved\u0027;\n    settingsRecord.ApprovedEmail \u003d \u0027\u003cp\u003eYour request for the document \u0027 +\n      \u0027\u003c? if (data.Request.DocumentUrl) { ?\u003e\u0027 +\n      \u0027\u003ca href\u003d\"\u003c?\u003d data.Request.DocumentUrl ?\u003e\" target\u003d\"_blank\"\u003e\u003c?\u003d data.Request.DocumentName ?\u003e\u003c\/a\u003e\u0027 +\n      \u0027\u003c? } else { ?\u003e\u0027 +\n      \u0027  \u003c?\u003d data.Request.DocumentName ?\u003e\u0027 +\n      \u0027\u003c? } ?\u003e has been approved.\u003c\/p\u003e\u0027 +\n      \u0027\u003cp\u003eClick \u003ca href\u003d\"\u003c?\u003d data.AppUrlRequest ?\u003e\" target\u003d\"_blank\"\u003ehere\u003c\/a\u003e to view it in the app.\u003c\/p\u003e\u0027;\n    \n    settingsRecord.RejectedEmailSubject \u003d \u0027Your request has been rejected\u0027;\n    settingsRecord.RejectedEmail \u003d \u0027\u003cp\u003eYour request for the document \u0027 +\n      \u0027\u003c? if (data.Request.DocumentUrl) { ?\u003e\u0027 +\n      \u0027\u003ca href\u003d\"\u003c?\u003d data.Request.DocumentUrl ?\u003e\" target\u003d\"_blank\"\u003e\u003c?\u003d data.Request.DocumentName ?\u003e\u003c\/a\u003e\u0027 +\n      \u0027\u003c? } else { ?\u003e\u0027 +\n      \u0027  \u003c?\u003d data.Request.DocumentName ?\u003e\u0027 +\n      \u0027\u003c? } ?\u003e has been rejected.\u003c\/p\u003e\u0027 +\n      \u0027\u003cp\u003eClick \u003ca href\u003d\"\u003c?\u003d data.AppUrlRequest ?\u003e\" target\u003d\"_blank\"\u003ehere\u003c\/a\u003e to view it in the app.\u003c\/p\u003e\u0027;\n    \n    app.saveRecords([settingsRecord]);\n    return [settingsRecord];\n  } else {\n    return settingsRecords;\n  }\n}\n",
  "key": "Y0HE9jYZlyfMFssKfeM4la0T8DQwsi90",
  "name": "Datasources",
  "type": "SERVER"
}