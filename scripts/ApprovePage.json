{
  "content": "/**\n * @fileoverview Client script functions for Approve page.\n */\n\n\n/**\n * Loads page\u0027s datasource after setting all required filters.\n */\nfunction loadDataForApprovalCount() {\n  var ds \u003d app.datasources.AwaitingMyApprovalCount;\n  ds.load();\n}\n\n\n/**\n * Loads page\u0027s datasource after setting all required filters.\n *\n * @param {boolean} opt_showAll - flag indicating if only active \n *     records should be visible (optional).\n */\nfunction loadDataForApprove(opt_showAll) {\n  app.showDialog(app.pageFragments.Loading);\n  \n  var showAll \u003d !!opt_showAll;\n  \n  var ds \u003d app.datasources.AwaitingMyApproval;\n  \n  if (showAll !\u003d\u003d ds.query.parameters.showAll) {\n    ds.query.pageIndex \u003d 1;\n  }\n  ds.query.parameters.showAll \u003d showAll;\n  ds.load({\n    success: function() {\n      app.closeDialog();\n    },\n    failure: function() {\n      app.closeDialog();\n    }\n  });\n}\n\n\n/**\n * Performs approve request action by calling a corresponding server-side\n * function.\n * @param {Approver} approver - document approval record for the current user;\n * @param {Widget} commentWidget - comment field.\n */\nfunction approveRequest(approver, commentWidget) {\n  commentWidget.validationErrors \u003d [];\n  \n  var opt_comment \u003d commentWidget.value;\n  \n  app.showDialog(app.pageFragments.Loading);  \n  google.script.run\n    .withSuccessHandler(function() {\n      commentWidget.value \u003d \u0027\u0027;\n      commentWidget.root.datasource.load({\n        success: function() {\n          app.closeDialog();\n        }, \n        failure: function() {\n          app.closeDialog();\n        }\n      });\n      app.datasources.AwaitingMyApprovalCount.load();\n    })\n    .withFailureHandler(function(error) {\n      app.closeDialog();\n      console.error(\u0027approveRequest error: \u0027 + JSON.stringify(error));\n    })\n    .approveRequest(approver._key, opt_comment);\n}\n\n\n/**\n * Performs reject request action by calling a corresponding server-side\n * function.\n * @param {Approver} approver - document approval record for the current user;\n * @param {Widget} commentWidget - comment field.\n */\nfunction rejectRequest(approver, commentWidget) {\n  var comment \u003d commentWidget.value;\n  if (!comment) {\n    commentWidget.validationErrors \u003d [\u0027Required\u0027];\n    return;\n  } else {\n    commentWidget.validationErrors \u003d [];\n  }\n\n  app.showDialog(app.pageFragments.Loading);\n  \n  google.script.run\n    .withSuccessHandler(function() {\n      commentWidget.value \u003d \u0027\u0027;\n      commentWidget.root.datasource.load({\n        success: function() {\n          app.closeDialog();\n        }, \n        failure: function() {\n          app.closeDialog();\n        }\n      });\n      app.datasources.AwaitingMyApprovalCount.load();\n    })\n    .withFailureHandler(function(error) {\n      app.closeDialog();\n      console.error(\u0027rejectRequest error: \u0027 + JSON.stringify(error));\n    })\n    .rejectRequest(approver._key, comment);\n}\n\n\n/****** Utility functions for the page ******/\n\n/**\n * Builds a label with approval status.\n * @param {String} status - approval status;\n * @param {Date} lastUpdatedDate - date of the last update;\n * @return {string} approval status label.\n */\nfunction getApprovalStatusLabel(status, lastUpdatedDate) {\n  var label \u003d getStatusName(status);\n  if (lastUpdatedDate) {\n    label +\u003d \u0027 on \u0027 + lastUpdatedDate.toLocaleDateString();\n  }\n  return label;\n}\n\n\n/**\n * Builds a label with comment status.\n * @param {Date} addedOn - date of the comment creation;\n * @param {Boolean} isResolved - flag indicating if comment was resolved,\n *     important for rejected statuses;\n * @return {string} comment status label.\n */\nfunction getCommentMetadataLabel(addedOn, isResolved, resolvedOn) {\n  var label \u003d \u0027\u0027;\n  if (addedOn) {\n    label +\u003d \u0027Added on \u0027 + addedOn.toLocaleDateString() + \u0027 \u0027; \n  }\n  \n  if (isResolved) {\n    label +\u003d \u0027(Resolved\u0027;\n    \n    if (resolvedOn) {\n      label +\u003d \u0027 on \u0027 + resolvedOn.toLocaleDateString();\n    }\n    \n    label +\u003d \u0027)\u0027;\n    \n  }\n  return label;\n}\n",
  "key": "PbeUdbp8PA23mmwJa3tN8z0WqXhXbYMc",
  "name": "ApprovePage",
  "type": "CLIENT"
}